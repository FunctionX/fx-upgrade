<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>f(x)Core validator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<body>
<div class="container-fluid text-center">
    <div class="row">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Validator</th>
                <th scope="col">Status</th>
                <th scope="col">Is Jailed</th>
                <th scope="col">Is Sign</th>
                <!--                <th scope="col">Missed Blocks</th>-->
            </tr>
            </thead>
            <tbody id="isSign">
            </tbody>
        </table>
    </div>
</div>


<script type="text/javascript">
    function httpGetJson(theUrl) {
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        const response = JSON.parse(xmlHttp.responseText)
        if (response.result) {
            return response.result;
        }
        return response;
    }

    // const fxRestUrl = "http://127.0.0.1:1317";
    const fxRestUrl = "https://fx-rest.functionx.io:1317";

    // const fxUrl = "http://127.0.0.1:26657";
    const fxUrl = "https://fx-json.functionx.io:26657";

    function getValidators() {
        const result = httpGetJson(fxRestUrl + "/cosmos/staking/v1beta1/validators")
        return result.validators
    }

    function getBlockSignatures() {
        const result = httpGetJson(fxUrl + "/block")
        return result.block.last_commit.signatures
    }

    const signBody = document.getElementById("isSign")

    function update() {
        const blockSignatures = getBlockSignatures()
        const validators = getValidators()
        signBody.innerHTML = ''
        validators.sort((val1, val2) => {
            const a = BigInt(val1.tokens)
            const b = BigInt(val2.tokens)
            if (a < b) {
                return -1;
            }
            if (a > b) {
                return 1;
            }
            return 0;
        }).forEach((validator, index) => {
            let para = document.createElement('tr');
            para.innerHTML = `
                <th scope="row">${index + 1}</th>
                <td>${validator.description.moniker}</td>
                <td>${validator.status}</td>
                <td>${validator.jailed ? "❌" : "✅"}</td>
                <td>${blockSignatures[index].signature !== null ? "✅" : "❌"}</td>`
            signBody.appendChild(para)
        })
    }

    update()
    window.setInterval(function () {
        update()
    }, 10000);
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
        integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>
</body>
</html>