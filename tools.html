<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>f(x)Core Module Balances</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<body>
<div class="text-center">
    <h2>CurrentModule: <span id="currentModule">ERC20</span></h2>
        <ul class="list-group">
            <li class="list-group-item"><a href="tools.html?module=total">Query Total</a></li>
            <li class="list-group-item"><a href="tools.html">Query ERC20</a></li>
        </ul>
    <div class="row">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Symbol</th>
                <th scope="col">Balances</th>
            </tr>
            </thead>
            <tbody id="crosschain">
            </tbody>
        </table>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
        integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>
<script src="src/js/bech32.js"></script>
<script src="src/js/index.js"></script>
<script type="text/javascript">
    let module = getQueryVariable("module")
    let moduleAddress = "fx1glht96kr2rseywuvhhay894qw7ekuc4qs5z0yh"
    if (module === "total") {
        moduleAddress = "total"
    }

    const metadatas = getMetadatas()

    function getModuleBalances(moduleAddress) {
        let balances
        if (!moduleAddress) {
            balances = getTotalSupply()
        } else {
            balances = getBalances(moduleAddress)
        }
        return balances
    }

    function balancesSymbol(balances) {
        for (let i = 0; i < balances.length; i++) {
            for (let j = 0; j < metadatas.length; j++) {
                if (balances[i].denom === metadatas[j].base) {
                    balances[i].symbol = metadatas[j].symbol
                    let exponent = 18
                    if (balances[i].symbol !== "FX") {
                        exponent = metadatas[j].denom_units[1].exponent
                    }
                    balances[i].exponent = exponent
                }
                const aliases = metadatas[j].denom_units[0].aliases
                for (let k = 0; k < aliases.length; k++) {
                    if (balances[i].denom === aliases[k]) {
                        balances[i].symbol = metadatas[j].symbol
                        balances[i].exponent = metadatas[j].denom_units[1].exponent
                    }
                }
            }
        }
        return balances
    }

    const signBody = document.getElementById("crosschain")
    signBody.innerHTML = ''

    let balances = getModuleBalances(module === "total" ? "" : moduleAddress)
    balances = balancesSymbol(balances);
    balances.sort((a, b) => {
        return a.symbol.localeCompare(b.symbol)
    })
    for (let i = 0; i < balances.length; i++) {
        let balance = balances[i]
        let exponent = balance.exponent
        let decimal = "1" + ("0".repeat(exponent - 2))
        let para = document.createElement('tr');
        para.innerHTML = `
                <th scope="row">${i + 1}</th>
                <td style="text-align: left">${balance.symbol}(${balance.denom})</td>
                <td style="text-align: left">${(Number(BigInt(balance.amount) / BigInt(decimal)) / 100).toLocaleString()}</td>`

        signBody.appendChild(para)
    }
</script>
</body>
</html>